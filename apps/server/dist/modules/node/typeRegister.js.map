{"version":3,"file":"typeRegister.js","names":["getTypeRegister","typesLoaders","getTypesLoaders","registerTypeLoader","type","load","name","nodeField","nodesField","nodeInterface","nodeDefinitions","globalId","context","id","fromGlobalId","obj","constructor"],"sources":["../../../src/modules/node/typeRegister.ts"],"sourcesContent":["import { GraphQLObjectType } from 'graphql';\n\nimport { fromGlobalId, nodeDefinitions } from 'graphql-relay';\n\nimport { GraphQLContext } from '../graphql/types';\n\ntype Load = (context: GraphQLContext, id: string) => any;\ntype TypeLoaders = {\n  [key: string]: {\n    type: GraphQLObjectType;\n    load: Load;\n  };\n};\n\nconst getTypeRegister = () => {\n  const typesLoaders: TypeLoaders = {};\n\n  const getTypesLoaders = () => typesLoaders;\n\n  const registerTypeLoader = (type: GraphQLObjectType, load: Load) => {\n    typesLoaders[type.name] = {\n      type,\n      load,\n    };\n\n    return type;\n  };\n\n  const { nodeField, nodesField, nodeInterface } = nodeDefinitions(\n    // @ts-ignore\n    (globalId, context: GraphQLContext) => {\n      const { type, id } = fromGlobalId(globalId);\n\n      const { load } = typesLoaders[type] || { load: null };\n\n      return (load && load(context, id)) || null;\n    },\n    // @ts-ignore\n    obj => {\n      const { type } = typesLoaders[obj.constructor.name] || { type: null };\n\n      return type;\n    },\n  );\n\n  return {\n    registerTypeLoader,\n    getTypesLoaders,\n    nodeField,\n    nodesField,\n    nodeInterface,\n  };\n};\n\nconst { registerTypeLoader, nodeInterface, nodeField, nodesField } = getTypeRegister();\n\nexport { registerTypeLoader, nodeInterface, nodeField, nodesField };\n"],"mappings":";;;;;;;AAEA;;AAYA,MAAMA,eAAe,GAAG,MAAM;EAC5B,MAAMC,YAAyB,GAAG,EAAlC;;EAEA,MAAMC,eAAe,GAAG,MAAMD,YAA9B;;EAEA,MAAME,kBAAkB,GAAG,CAACC,IAAD,EAA0BC,IAA1B,KAAyC;IAClEJ,YAAY,CAACG,IAAI,CAACE,IAAN,CAAZ,GAA0B;MACxBF,IADwB;MAExBC;IAFwB,CAA1B;IAKA,OAAOD,IAAP;EACD,CAPD;;EASA,MAAM;IAAEG,SAAF;IAAaC,UAAb;IAAyBC;EAAzB,IAA2C,IAAAC,6BAAA,GAC/C;EACA,CAACC,QAAD,EAAWC,OAAX,KAAuC;IACrC,MAAM;MAAER,IAAF;MAAQS;IAAR,IAAe,IAAAC,0BAAA,EAAaH,QAAb,CAArB;IAEA,MAAM;MAAEN;IAAF,IAAWJ,YAAY,CAACG,IAAD,CAAZ,IAAsB;MAAEC,IAAI,EAAE;IAAR,CAAvC;IAEA,OAAQA,IAAI,IAAIA,IAAI,CAACO,OAAD,EAAUC,EAAV,CAAb,IAA+B,IAAtC;EACD,CAR8C,EAS/C;EACAE,GAAG,IAAI;IACL,MAAM;MAAEX;IAAF,IAAWH,YAAY,CAACc,GAAG,CAACC,WAAJ,CAAgBV,IAAjB,CAAZ,IAAsC;MAAEF,IAAI,EAAE;IAAR,CAAvD;IAEA,OAAOA,IAAP;EACD,CAd8C,CAAjD;EAiBA,OAAO;IACLD,kBADK;IAELD,eAFK;IAGLK,SAHK;IAILC,UAJK;IAKLC;EALK,CAAP;AAOD,CAtCD;;AAwCA,MAAM;EAAEN,kBAAF;EAAsBM,aAAtB;EAAqCF,SAArC;EAAgDC;AAAhD,IAA+DR,eAAe,EAApF"}