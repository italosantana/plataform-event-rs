{"version":3,"file":"app.js","names":["app","Koa","router","Router","graphQlSettingsPerReq","req","user","getUser","header","authorization","graphiql","config","NODE_ENV","headerEditorEnabled","shouldPersistHeaders","schema","pretty","context","getContext","customFormatErrorFn","message","locations","stack","console","log","graphQlServer","graphqlHTTP","all","use","cors","bodyparser","routes","allowedMethods"],"sources":["../src/app.ts"],"sourcesContent":["import Koa, { Request } from 'koa';\nimport Router from '@koa/router';\nimport bodyparser from 'koa-bodyparser';\nimport { graphqlHTTP, OptionsData } from 'koa-graphql';\nimport cors from '@koa/cors';\n\nimport { schema } from '../src/modules/schema/schema';\nimport { config } from './config';\nimport { getUser } from './auth';\nimport { getContext } from './getContext';\n\nconst app = new Koa();\nconst router = new Router();\n\nconst graphQlSettingsPerReq = async (req: Request): Promise<OptionsData> => {\n    const user = await getUser(req.header.authorization);\n\n    return {\n        graphiql:\n            config.NODE_ENV !== 'production'\n                ? {\n                    headerEditorEnabled: true,\n                    shouldPersistHeaders: true,\n                }\n                : false,\n        schema,\n        pretty: true,\n        context: getContext({\n            user,\n        }),\n        customFormatErrorFn: ({ message, locations, stack }) => {\n            /* eslint-disable no-console */\n            console.log(message);\n            console.log(locations);\n            console.log(stack);\n            /* eslint-enable no-console */\n\n            return {\n                message,\n                locations,\n                stack,\n            };\n        },\n    };\n};\n\nconst graphQlServer = graphqlHTTP(graphQlSettingsPerReq);\nrouter.all('/graphql', graphQlServer);\n\napp.use(cors());\napp.use(bodyparser());\napp.use(router.routes()).use(router.allowedMethods());\n\nexport default app;"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,GAAG,GAAG,IAAIC,YAAJ,EAAZ;AACA,MAAMC,MAAM,GAAG,IAAIC,eAAJ,EAAf;;AAEA,MAAMC,qBAAqB;EAAA,6BAAG,WAAOC,GAAP,EAA8C;IACxE,MAAMC,IAAI,SAAS,IAAAC,aAAA,EAAQF,GAAG,CAACG,MAAJ,CAAWC,aAAnB,CAAnB;IAEA,OAAO;MACHC,QAAQ,EACJC,cAAA,CAAOC,QAAP,KAAoB,YAApB,GACM;QACEC,mBAAmB,EAAE,IADvB;QAEEC,oBAAoB,EAAE;MAFxB,CADN,GAKM,KAPP;MAQHC,MAAM,EAANA,cARG;MASHC,MAAM,EAAE,IATL;MAUHC,OAAO,EAAE,IAAAC,sBAAA,EAAW;QAChBZ;MADgB,CAAX,CAVN;MAaHa,mBAAmB,EAAE,CAAC;QAAEC,OAAF;QAAWC,SAAX;QAAsBC;MAAtB,CAAD,KAAmC;QACpD;QACAC,OAAO,CAACC,GAAR,CAAYJ,OAAZ;QACAG,OAAO,CAACC,GAAR,CAAYH,SAAZ;QACAE,OAAO,CAACC,GAAR,CAAYF,KAAZ;QACA;;QAEA,OAAO;UACHF,OADG;UAEHC,SAFG;UAGHC;QAHG,CAAP;MAKH;IAzBE,CAAP;EA2BH,CA9B0B;;EAAA,gBAArBlB,qBAAqB;IAAA;EAAA;AAAA,GAA3B;;AAgCA,MAAMqB,aAAa,GAAG,IAAAC,uBAAA,EAAYtB,qBAAZ,CAAtB;AACAF,MAAM,CAACyB,GAAP,CAAW,UAAX,EAAuBF,aAAvB;AAEAzB,GAAG,CAAC4B,GAAJ,CAAQ,IAAAC,aAAA,GAAR;AACA7B,GAAG,CAAC4B,GAAJ,CAAQ,IAAAE,sBAAA,GAAR;AACA9B,GAAG,CAAC4B,GAAJ,CAAQ1B,MAAM,CAAC6B,MAAP,EAAR,EAAyBH,GAAzB,CAA6B1B,MAAM,CAAC8B,cAAP,EAA7B;eAEehC,G"}