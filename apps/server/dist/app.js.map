{"version":3,"file":"app.js","names":["app","Koa","router","Router","graphqlSettingsPerReq","req","ctx","koaContext","event","dataloaders","getDataloaders","graphiql","schema","context","formatError","error","console","log","message","locations","stack","graphqlServer","GraphQLHTTP","get","body","all","koaPlayground","endpoint","use","bodyParser","cors","routes","allowedMethods"],"sources":["../src/app.ts"],"sourcesContent":["import { getDataloaders } from './modules/loader/loaderRegister';\n\nimport Koa from 'koa';\nimport GraphQLHTTP from 'koa-graphql';\nimport Router from 'koa-router';\nimport cors from '@koa/cors';\nimport bodyParser from 'koa-bodyparser';\n\nimport { schema } from './modules/schema/schema';\n\nimport koaPlayground from 'graphql-playground-middleware-koa';\n\nconst app = new Koa();\nconst router = new Router();\n\nconst graphqlSettingsPerReq = async (req, ctx, koaContext) => {\n    const { event } = koaContext;\n    const dataloaders = getDataloaders();\n\n    return {\n        graphiql: true,\n        schema,\n        context: {\n            event,\n            req,\n            dataloaders,\n        },\n        formatError: error => {\n            console.log(error.message);\n            console.log(error.locations);\n            console.log(error.stack);\n\n            return {\n                message: error.message,\n                locations: error.locations,\n                stack: error.stack,\n            };\n        },\n    };\n};\n\nconst graphqlServer = GraphQLHTTP(graphqlSettingsPerReq);\n\nrouter.get('/', async ctx => {\n    ctx.body = 'Ok';\n});\n\nrouter.all('/graphql', graphqlServer);\n\nrouter.all(\n    '/playground',\n    koaPlayground({\n        endpoint: '/graphql',\n    }),\n);\n\napp.use(bodyParser());\napp.use(cors());\napp.use(router.routes()).use(router.allowedMethods());\n\nexport default app;"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAEA;;;;;;;;AAEA,MAAMA,GAAG,GAAG,IAAIC,YAAJ,EAAZ;AACA,MAAMC,MAAM,GAAG,IAAIC,kBAAJ,EAAf;;AAEA,MAAMC,qBAAqB;EAAA,6BAAG,WAAOC,GAAP,EAAYC,GAAZ,EAAiBC,UAAjB,EAAgC;IAC1D,MAAM;MAAEC;IAAF,IAAYD,UAAlB;IACA,MAAME,WAAW,GAAG,IAAAC,8BAAA,GAApB;IAEA,OAAO;MACHC,QAAQ,EAAE,IADP;MAEHC,MAAM,EAANA,cAFG;MAGHC,OAAO,EAAE;QACLL,KADK;QAELH,GAFK;QAGLI;MAHK,CAHN;MAQHK,WAAW,EAAEC,KAAK,IAAI;QAClBC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,OAAlB;QACAF,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACI,SAAlB;QACAH,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACK,KAAlB;QAEA,OAAO;UACHF,OAAO,EAAEH,KAAK,CAACG,OADZ;UAEHC,SAAS,EAAEJ,KAAK,CAACI,SAFd;UAGHC,KAAK,EAAEL,KAAK,CAACK;QAHV,CAAP;MAKH;IAlBE,CAAP;EAoBH,CAxB0B;;EAAA,gBAArBhB,qBAAqB;IAAA;EAAA;AAAA,GAA3B;;AA0BA,MAAMiB,aAAa,GAAG,IAAAC,mBAAA,EAAYlB,qBAAZ,CAAtB;AAEAF,MAAM,CAACqB,GAAP,CAAW,GAAX;EAAA,8BAAgB,WAAMjB,GAAN,EAAa;IACzBA,GAAG,CAACkB,IAAJ,GAAW,IAAX;EACH,CAFD;;EAAA;IAAA;EAAA;AAAA;AAIAtB,MAAM,CAACuB,GAAP,CAAW,UAAX,EAAuBJ,aAAvB;AAEAnB,MAAM,CAACuB,GAAP,CACI,aADJ,EAEI,IAAAC,uCAAA,EAAc;EACVC,QAAQ,EAAE;AADA,CAAd,CAFJ;AAOA3B,GAAG,CAAC4B,GAAJ,CAAQ,IAAAC,sBAAA,GAAR;AACA7B,GAAG,CAAC4B,GAAJ,CAAQ,IAAAE,aAAA,GAAR;AACA9B,GAAG,CAAC4B,GAAJ,CAAQ1B,MAAM,CAAC6B,MAAP,EAAR,EAAyBH,GAAzB,CAA6B1B,MAAM,CAAC8B,cAAP,EAA7B;eAEehC,G"}